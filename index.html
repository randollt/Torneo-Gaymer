<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pron√≥sticos Torneo Apertura Gaymers</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Barlow', sans-serif; background: #0f1923; min-height: 100vh; color: #c8dae8; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; bottom: 24px; right: 24px; z-index: 9999;
  background: #2ecc71; color: #fff;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 15px; font-weight: 700; letter-spacing: 1px;
  padding: 12px 20px; border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.4);
  opacity: 0; transition: opacity 0.3s; pointer-events: none;
}
#toast.show { opacity: 1; }

/* ‚îÄ‚îÄ OVERLAY GEN√âRICO ‚îÄ‚îÄ */
.overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(8,14,22,0.93); z-index: 500;
  align-items: center; justify-content: center; padding: 20px;
}
.overlay.active { display: flex; }
.modal {
  background: #1a2332; border-radius: 16px;
  padding: 32px 28px; width: 100%; max-width: 400px;
  box-shadow: 0 16px 56px rgba(0,0,0,0.7);
  border: 1px solid #2a3d54;
}
.modal h2 {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 22px; font-weight: 800; color: #fff;
  letter-spacing: 2px; text-transform: uppercase;
  margin-bottom: 6px; text-align: center;
}
.modal p.sub { font-size: 13px; color: #7fa8c8; text-align: center; margin-bottom: 24px; }
.modal-error { color: #e74c3c; font-size: 12px; margin-top: 8px; text-align: center; min-height: 18px; }

/* ‚îÄ‚îÄ TEAM SELECTOR ‚îÄ‚îÄ */
.team-grid {
  display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 8px;
}
.team-btn {
  display: flex; align-items: center; gap: 10px;
  background: #1e2d3d; border: 2px solid #2a3d54;
  border-radius: 10px; padding: 12px 14px; cursor: pointer;
  transition: all 0.18s; text-align: left;
}
.team-btn:hover { border-color: #3498db; background: #243447; }
.team-btn.taken { opacity: 0.38; cursor: not-allowed; border-color: #1e2d3d; }
.team-btn.taken:hover { border-color: #1e2d3d; background: #1e2d3d; }
.team-btn img { width: 32px; height: 32px; flex-shrink: 0; }
.team-btn-info { display: flex; flex-direction: column; }
.team-btn-name { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 800; color: #fff; }
.team-btn-taken { font-size: 10px; color: #e74c3c; font-weight: 600; }
.team-btn-free { font-size: 10px; color: #2ecc71; font-weight: 600; }

/* ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ */
.navbar {
  background: #111e2b; border-bottom: 1px solid #1e2d3d;
  padding: 0 24px; display: flex; align-items: center;
  justify-content: space-between; height: 56px;
  position: sticky; top: 0; z-index: 100;
}
.navbar-brand {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 17px; font-weight: 800; color: #fff;
  letter-spacing: 2px; text-transform: uppercase;
}
.navbar-brand span { color: #3498db; }
.navbar-right { display: flex; align-items: center; gap: 12px; }
.user-pill {
  display: flex; align-items: center; gap: 8px;
  background: #1e2d3d; border-radius: 20px;
  padding: 4px 12px 4px 4px; font-size: 13px; color: #c8dae8;
}
.user-pill img { width: 28px; height: 28px; border-radius: 50%; }
.btn-nav {
  background: transparent; border: 1px solid #2e4060;
  border-radius: 8px; padding: 6px 14px; color: #7fa8c8;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 13px; font-weight: 700; letter-spacing: 1px;
  cursor: pointer; transition: all 0.2s;
}
.btn-nav:hover { background: #1e2d3d; color: #fff; }
.btn-nav.primary { background: #3498db; border-color: #3498db; color: #fff; }
.btn-nav.primary:hover { background: #2980b9; }

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs {
  display: flex; gap: 0; background: #111e2b;
  border-bottom: 1px solid #1e2d3d;
  overflow-x: auto; padding: 0 24px;
}
.tab {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 14px; font-weight: 700; letter-spacing: 1px;
  text-transform: uppercase; color: #6a8fad;
  padding: 14px 20px; cursor: pointer;
  border-bottom: 3px solid transparent;
  white-space: nowrap; transition: all 0.2s;
}
.tab:hover { color: #c8dae8; }
.tab.active { color: #fff; border-bottom-color: #3498db; }

/* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
.page { display: none; padding: 24px; max-width: 1100px; margin: 0 auto; }
.page.active { display: block; }

/* ‚îÄ‚îÄ APP HEADER ‚îÄ‚îÄ */
.app-header {
  background: linear-gradient(135deg, #0d1f30 0%, #1a3a52 50%, #0d1f30 100%);
  border-radius: 14px; padding: 28px 32px 22px;
  margin-bottom: 24px; border: 1px solid #2a3d54;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  text-align: center; position: relative; overflow: hidden;
}
.app-header::before {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(ellipse at 50% 0%, rgba(52,152,219,0.12) 0%, transparent 70%);
  pointer-events: none;
}
.app-header-emoji { font-size: 28px; margin-bottom: 6px; display: block; }
.app-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: clamp(22px, 4vw, 36px); font-weight: 800; color: #fff;
  letter-spacing: 3px; text-transform: uppercase; line-height: 1.1; margin-bottom: 10px;
}
.app-title span { color: #3498db; }
.app-divider {
  width: 60px; height: 3px;
  background: linear-gradient(90deg, #3498db, #2ecc71);
  border-radius: 2px; margin: 10px auto 14px;
}
.app-subtitle { font-size: clamp(12px, 2vw, 14px); color: #a8c8e0; line-height: 1.6; max-width: 620px; margin: 0 auto; }
.app-subtitle strong { color: #f1c40f; }
.app-subtitle .premio { color: #2ecc71; font-style: italic; }

/* ‚îÄ‚îÄ TABLA ‚îÄ‚îÄ */
.tabla-container {
  background: #1a2332; border-radius: 12px;
  overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  margin-bottom: 24px;
}
.tabla-title {
  background: #243447; text-align: center; padding: 14px 20px;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 20px; font-weight: 800; color: #fff;
  letter-spacing: 3px; text-transform: uppercase;
  border-bottom: 2px solid #2e4060;
}
.zona-header {
  background: #1e2d3d; padding: 8px 16px;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 14px; font-weight: 700; color: #7fa8c8;
  letter-spacing: 2px; text-transform: uppercase;
  border-bottom: 1px solid #2a3d54;
}
table { width: 100%; border-collapse: collapse; }
thead tr { background: #1e2d3d; }
thead th {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 11px; font-weight: 700; color: #6a8fad;
  text-transform: uppercase; letter-spacing: 1px;
  padding: 8px 6px; text-align: center; border-bottom: 1px solid #2a3d54;
}
thead th.team-col { text-align: left; padding-left: 12px; }
tbody tr { border-bottom: 1px solid #1e2d3d; transition: background 0.15s; }
tbody tr:hover { background: #223040; }
tbody tr.top1   { border-left: 3px solid #f1c40f; }
tbody tr.octavos { border-left: 3px solid #3498db; }
td { padding: 9px 6px; text-align: center; font-size: 13px; color: #c8dae8; font-weight: 500; }
td.pos { font-family: 'Barlow Condensed', sans-serif; font-size: 15px; font-weight: 800; width: 28px; }
td.pos.p1   { color: #f1c40f; }
td.pos.pmid { color: #3498db; }
td.pos.plow { color: #8fa8c0; }
td.team-name { text-align: left; padding-left: 6px; font-size: 13px; font-weight: 600; color: #ddeeff; white-space: nowrap; }
td.pts { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 800; color: #fff; }
.team-cell { display: flex; align-items: center; gap: 8px; }
.escudo { width: 28px; height: 28px; flex-shrink: 0; }
.badge { display: inline-flex; align-items: center; justify-content: center; width: 22px; height: 22px; border-radius: 4px; font-family: 'Barlow Condensed', sans-serif; font-size: 12px; font-weight: 800; margin: 0 1px; }
.badge.V { background: #2ecc71; color: #fff; }
.badge.E { background: #f39c12; color: #fff; }
.badge.D { background: #e74c3c; color: #fff; }
.ultimas { display: flex; gap: 3px; justify-content: center; align-items: center; }
.leyenda { background: #1a2332; padding: 10px 16px; display: flex; align-items: center; gap: 16px; font-size: 11px; color: #6a8fad; border-top: 1px solid #2a3d54; flex-wrap: wrap; }
.leyenda-item { display: flex; align-items: center; gap: 6px; }
.dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.dot.gold { background: #f1c40f; }
.dot.blue { background: #3498db; }

/* ‚îÄ‚îÄ PRON√ìSTICOS ‚îÄ‚îÄ */
.pronostico-card {
  background: #1a2332; border-radius: 12px; padding: 20px;
  margin-bottom: 16px; border: 1px solid #2a3d54;
}
.pronostico-card h3 {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 16px; font-weight: 800; color: #fff;
  text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;
}
.pronostico-card .match-info { font-size: 12px; color: #7fa8c8; margin-bottom: 16px; }
.pronostico-form { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.score-input-group { display: flex; align-items: center; gap: 8px; }
.score-input-group label { font-size: 12px; color: #7fa8c8; text-transform: uppercase; letter-spacing: 1px; }
.score-input {
  width: 52px; background: #243447; border: 1px solid #2e4060;
  border-radius: 6px; padding: 8px; color: #fff; font-size: 18px;
  font-family: 'Barlow Condensed', sans-serif; font-weight: 800;
  text-align: center; outline: none;
}
.score-input:focus { border-color: #3498db; }
.score-sep { font-size: 22px; font-weight: 800; color: #4a6a84; }
.btn-pronostico {
  background: #2ecc71; border: none; border-radius: 8px;
  padding: 10px 20px; color: #fff;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 14px; font-weight: 800; letter-spacing: 1px;
  cursor: pointer; transition: background 0.2s; white-space: nowrap;
}
.btn-pronostico:hover { background: #27ae60; }
.btn-pronostico:disabled { background: #2a4a3a; color: #5a8a6a; cursor: not-allowed; }
.pronostico-locked {
  background: #1e2d3d; border-radius: 8px; padding: 12px 16px;
  font-size: 13px; color: #7fa8c8; display: flex; align-items: center; gap: 8px;
}
.pronostico-result {
  display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;
}
.pronos-list { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
.prono-row {
  display: flex; align-items: center; justify-content: space-between;
  background: #1e2d3d; border-radius: 8px; padding: 10px 14px;
  font-size: 13px;
}
.prono-row .name { font-weight: 600; color: #ddeeff; }
.prono-row .score { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 800; color: #fff; }
.prono-row .pts-earned { font-family: 'Barlow Condensed', sans-serif; font-size: 14px; font-weight: 800; }
.prono-row .pts-earned.win { color: #2ecc71; }
.prono-row .pts-earned.lose { color: #e74c3c; }
.prono-row .pts-earned.pending { color: #f39c12; }
.no-match { background: #1a2332; border-radius: 12px; padding: 40px 20px; text-align: center; color: #4a6a84; }
.no-match .icon { font-size: 40px; margin-bottom: 12px; }

/* ‚îÄ‚îÄ BOCA PARTIDOS ‚îÄ‚îÄ */
.fixtures-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
.fixture-card {
  background: #1a2332; border-radius: 12px; overflow: hidden;
  border: 1px solid #2a3d54; transition: transform 0.15s;
}
.fixture-card:hover { transform: translateY(-2px); }
.fixture-card.live { border-color: #e74c3c; }
.fixture-header {
  background: #1e2d3d; padding: 8px 14px;
  display: flex; justify-content: space-between; align-items: center;
  font-size: 11px; color: #7fa8c8;
  font-family: 'Barlow Condensed', sans-serif; letter-spacing: 1px; text-transform: uppercase;
}
.live-badge {
  background: #e74c3c; color: #fff; border-radius: 4px;
  padding: 2px 8px; font-size: 11px; font-weight: 800;
  letter-spacing: 1px; animation: pulse 1.5s infinite;
}
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.6; } }
.fixture-body { padding: 16px; }
.fixture-teams { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.fixture-team { display: flex; flex-direction: column; align-items: center; gap: 6px; flex: 1; }
.fixture-team-logo { width: 44px; height: 44px; object-fit: contain; }
.fixture-team-name { font-size: 13px; font-weight: 700; color: #ddeeff; text-align: center; line-height: 1.2; }
.fixture-score-box { text-align: center; min-width: 70px; }
.fixture-score {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 32px; font-weight: 800; color: #fff; line-height: 1;
}
.fixture-score.live-score { color: #e74c3c; }
.fixture-time { font-size: 12px; color: #7fa8c8; margin-top: 4px; }
.fixture-minute { font-family: 'Barlow Condensed', sans-serif; font-size: 13px; font-weight: 800; color: #e74c3c; }
.fixture-footer {
  padding: 10px 14px; border-top: 1px solid #1e2d3d;
  font-size: 11px; color: #7fa8c8; display: flex; gap: 12px; flex-wrap: wrap;
}
.fixture-footer span { display: flex; align-items: center; gap: 4px; }
.loading-fixtures { text-align: center; padding: 48px 20px; color: #4a6a84; }
.loading-fixtures .spinner {
  width: 36px; height: 36px; border: 3px solid #2a3d54;
  border-top-color: #3498db; border-radius: 50%;
  animation: spin 0.8s linear infinite; margin: 0 auto 16px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ */
.admin-panel {
  background: #1a2332; border-radius: 12px; padding: 20px;
  border: 1px solid #8e44ad; margin-bottom: 24px;
}
.admin-panel h2 {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 18px; font-weight: 800; color: #fff;
  letter-spacing: 2px; text-transform: uppercase;
  margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
}
.admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
@media(max-width: 600px) { .admin-grid { grid-template-columns: 1fr; } }
.admin-section { background: #1e2d3d; border-radius: 8px; padding: 14px; }
.admin-section h3 { font-family: 'Barlow Condensed', sans-serif; font-size: 14px; font-weight: 700; color: #7fa8c8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
.form-row { margin-bottom: 10px; }
.form-row label { font-size: 11px; color: #6a8fad; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 4px; }
.form-row input, .form-row select {
  width: 100%; background: #243447; border: 1px solid #2e4060;
  border-radius: 6px; padding: 7px 10px; color: #fff;
  font-family: 'Barlow', sans-serif; font-size: 13px; outline: none;
}
.form-row input:focus, .form-row select:focus { border-color: #8e44ad; }
.fields-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; }
.fields-grid .form-row { margin-bottom: 0; }
.ultimas-row { display: flex; gap: 6px; margin-top: 8px; }
.ultimas-row select { flex: 1; background: #243447; border: 1px solid #2e4060; border-radius: 6px; padding: 6px 4px; color: #fff; font-family: 'Barlow', sans-serif; font-size: 13px; outline: none; text-align: center; }

/* ‚îÄ‚îÄ BOTONES GENERALES ‚îÄ‚îÄ */
.btn { border: none; border-radius: 8px; padding: 10px 16px; font-family: 'Barlow Condensed', sans-serif; font-size: 14px; font-weight: 800; letter-spacing: 1px; cursor: pointer; transition: all 0.2s; width: 100%; margin-top: 8px; }
.btn.green  { background: #2ecc71; color: #fff; } .btn.green:hover  { background: #27ae60; }
.btn.blue   { background: #3498db; color: #fff; } .btn.blue:hover   { background: #2980b9; }
.btn.purple { background: #8e44ad; color: #fff; } .btn.purple:hover { background: #6c3483; }
.btn.red    { background: transparent; border: 1px solid #e74c3c; color: #e74c3c; } .btn.red:hover { background: #e74c3c; color: #fff; }
.btn.orange { background: #f39c12; color: #fff; } .btn.orange:hover { background: #e67e22; }
.btn:disabled { opacity: 0.4; cursor: not-allowed; }
.sep { border: none; border-top: 1px solid #2a3d54; margin: 14px 0; }
.sync-status { font-size: 10px; text-align: center; margin-top: 8px; color: #7fa8c8; }
.sync-status.ok { color: #2ecc71; } .sync-status.err { color: #e74c3c; } .sync-status.loading { color: #f39c12; }

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.section-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 18px; font-weight: 800; color: #fff;
  letter-spacing: 2px; text-transform: uppercase;
  margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
}
.section-title::after { content: ''; flex: 1; height: 1px; background: #2a3d54; }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.app-footer { text-align: center; padding: 24px; font-size: 12px; color: #3d5a72; font-family: 'Barlow Condensed', sans-serif; letter-spacing: 1px; }
.app-footer span { color: #3498db; font-weight: 700; }

/* ‚îÄ‚îÄ GOOGLE BTN ‚îÄ‚îÄ */
.btn-google {
  display: flex; align-items: center; justify-content: center; gap: 10px;
  background: #fff; color: #333; border: none; border-radius: 8px;
  padding: 12px 20px; width: 100%; cursor: pointer;
  font-family: 'Barlow', sans-serif; font-size: 15px; font-weight: 600;
  transition: background 0.2s; margin-top: 8px;
}
.btn-google:hover { background: #f0f0f0; }
.btn-google svg { flex-shrink: 0; }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width: 600px) {
  .page { padding: 16px; }
  .fixtures-grid { grid-template-columns: 1fr; }
  .navbar-brand { font-size: 14px; }
}

/* ‚îÄ‚îÄ USUARIOS AUTORIZADOS (admin view) ‚îÄ‚îÄ */
.user-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #2a3d54; font-size: 13px; }
.user-row:last-child { border-bottom: none; }
.user-row .uid { font-size: 10px; color: #4a6a84; font-family: monospace; }
.btn-small { border: none; border-radius: 6px; padding: 4px 10px; font-family: 'Barlow Condensed', sans-serif; font-size: 12px; font-weight: 700; cursor: pointer; }
.btn-small.red { background: #e74c3c; color: #fff; }
.add-user-row { display: flex; gap: 8px; margin-top: 10px; }
.add-user-row input { flex: 1; background: #243447; border: 1px solid #2e4060; border-radius: 6px; padding: 8px 10px; color: #fff; font-family: 'Barlow', sans-serif; font-size: 13px; outline: none; }
</style>
</head>
<body>

<div id="toast"></div>

<!-- ‚ïê‚ïê LOGIN OVERLAY ‚ïê‚ïê -->
<div class="overlay" id="login-overlay">
  <div class="modal">
    <h2>‚öΩ Gaymers</h2>
    <p class="sub">Inici√° sesi√≥n para ver y cargar tus pron√≥sticos</p>
    <button class="btn-google" id="btn-google-login">
      <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
      Continuar con Google
    </button>
    <div class="modal-error" id="login-error"></div>
    <p style="font-size:11px;color:#4a6a84;text-align:center;margin-top:16px;">Solo participantes autorizados pueden acceder</p>
  </div>
</div>

<!-- ‚ïê‚ïê TEAM SELECT OVERLAY ‚ïê‚ïê -->
<div class="overlay" id="team-select-overlay">
  <div class="modal">
    <h2>üëã ¬°Bienvenido!</h2>
    <p class="sub" id="team-select-sub">Email registrado. ¬øCu√°l es tu nombre en el torneo?</p>
    <div class="team-grid" id="team-grid">
      <!-- Se llena din√°micamente -->
    </div>
    <div class="modal-error" id="team-select-error"></div>
  </div>
</div>

<!-- ‚ïê‚ïê NAVBAR ‚ïê‚ïê -->
<nav class="navbar">
  <div class="navbar-brand">‚öΩ <span>Gaymers</span> FC</div>
  <div class="navbar-right">
    <div class="user-pill" id="user-pill" style="display:none">
      <img id="user-avatar" src="" alt="">
      <span id="user-name-nav"></span>
    </div>
    <button class="btn-nav" id="btn-logout-nav" style="display:none" id="btn-do-logout">Salir</button>
    <button class="btn-nav primary" id="btn-login-nav" data-action="showLogin">Entrar</button>
  </div>
</nav>

<!-- ‚ïê‚ïê TABS ‚ïê‚ïê -->
<div class="tabs" id="main-tabs">
  <div class="tab active" data-tab="tabla">üèÜ Tabla</div>
  <div class="tab" data-tab="pronosticos">üéØ Pron√≥sticos</div>
  <div class="tab" data-tab="boca">‚öΩ Partidos de Boca</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: TABLA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-tabla">
  <div class="app-header">
    <span class="app-header-emoji">‚öΩüéÆ</span>
    <div class="app-title">Pron√≥sticos Torneo <span>Apertura</span> Gaymers</div>
    <div class="app-divider"></div>
    <div class="app-subtitle">
      Cada vez que aciertes el resultado de un partido de <strong>Boca</strong>, sum√°s <strong>3 puntos</strong>.<br>
      El ganador se queda con <span class="premio">la hermana de Lalo</span> üëÄ ‚Äî o se debate en el grupo de WhatsApp üí¨
    </div>
  </div>

  <div class="tabla-container">
    <div class="tabla-title">Apertura</div>
    <div class="zona-header">Zona A</div>
    <table>
      <thead>
        <tr>
          <th>#</th><th class="team-col">Jugador</th>
          <th>PTS</th><th>J</th><th>Gol</th><th>+/-</th>
          <th>G</th><th>E</th><th>P</th><th>√öltimas</th>
        </tr>
      </thead>
      <tbody id="tabla-body"></tbody>
    </table>
    <div class="leyenda">
      <div class="leyenda-item"><div class="dot gold"></div><span>1er puesto</span></div>
      <div class="leyenda-item"><div class="dot blue"></div><span>Octavos de Final</span></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: PRON√ìSTICOS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-pronosticos">
  <div class="section-title">üéØ Mis Pron√≥sticos</div>
  <div id="pronosticos-content">
    <div class="no-match"><div class="icon">üîí</div><p>Inici√° sesi√≥n para ver y cargar tus pron√≥sticos</p></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB: BOCA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-boca">
  <div class="section-title">‚öΩ Partidos de Boca</div>
  <div id="boca-content">
    <div class="loading-fixtures">
      <div class="spinner"></div>
      <p>Cargando partidos...</p>
    </div>
  </div>
</div>

<div class="app-footer">
  App creada para los Gaymers &nbsp;¬∑&nbsp; By <span>Crysis Powerrade</span> ‚ö°
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMIN PANEL (oculto ‚Äî Ctrl+Shift+A)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="admin-wrapper" style="display:none; padding: 0 24px 24px; max-width:1100px; margin:0 auto;">
  <div class="admin-panel">
    <h2>üîê Panel Administrador <span style="font-size:12px;color:#8e44ad;font-weight:400;margin-left:8px;">Ctrl+Shift+A para ocultar</span></h2>
    <div class="admin-grid">

      <!-- Editar equipo -->
      <div class="admin-section">
        <h3>‚úèÔ∏è Editar equipo</h3>
        <div class="form-row">
          <label>Seleccionar</label>
          <select id="sel-team" id="sel-team-input"></select>
        </div>
        <div class="form-row">
          <label>Nombre</label>
          <input type="text" id="ed-name">
        </div>
        <div class="fields-grid">
          <div class="form-row"><label>PTS</label><input type="number" id="ed-pts" min="0"></div>
          <div class="form-row"><label>J</label><input type="number" id="ed-j" min="0"></div>
          <div class="form-row"><label>G</label><input type="number" id="ed-g" min="0"></div>
          <div class="form-row"><label>E</label><input type="number" id="ed-e" min="0"></div>
          <div class="form-row"><label>P</label><input type="number" id="ed-p" min="0"></div>
          <div class="form-row"><label>GF</label><input type="number" id="ed-gf" min="0"></div>
          <div class="form-row"><label>GC</label><input type="number" id="ed-gc" min="0"></div>
        </div>
        <div class="form-row" style="margin-top:10px">
          <label>√öltimas 5 fechas</label>
          <div class="ultimas-row">
            <select id="ul-1"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
            <select id="ul-2"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
            <select id="ul-3"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
            <select id="ul-4"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
            <select id="ul-5"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
          </div>
        </div>
        <button class="btn green" data-action="adminSaveTeam">‚úÖ Guardar cambios</button>
        <button class="btn red" data-action="adminDeleteTeam" style="margin-top:6px">üóëÔ∏è Eliminar equipo</button>
        <hr class="sep">
        <h3 style="margin-bottom:10px">‚ûï Nuevo equipo</h3>
        <div class="add-user-row">
          <input type="text" id="new-team-name" placeholder="Nombre...">
        </div>
        <button class="btn purple" data-action="adminAddTeam">‚ûï Agregar equipo</button>
        <hr class="sep">
        <button class="btn blue" data-action="adminSortTeams">üîÉ Reordenar por puntos</button>
        <div class="sync-status" id="sync-status">‚è≥ Conectando...</div>
      </div>

      <!-- Usuarios autorizados -->
      <div class="admin-section">
        <h3>üë• Jugadores autorizados</h3>
        <div id="auth-users-list"><p style="font-size:12px;color:#4a6a84">Cargando...</p></div>
        <hr class="sep">
        <h3 style="margin-bottom:10px">‚ûï Autorizar nuevo jugador</h3>
        <div class="form-row"><label>Nombre en la tabla (debe coincidir exactamente)</label>
          <select id="new-user-team"></select>
        </div>
        <div class="form-row"><label>Email de Google</label>
          <input type="email" id="new-user-email" placeholder="jugador@gmail.com">
        </div>
        <button class="btn purple" data-action="adminAddUser">‚úÖ Autorizar jugador</button>
        <hr class="sep">
        <h3 style="margin-bottom:8px">üéØ Resultado real (para sumar puntos)</h3>
        <div class="form-row"><label>Partido (ID o descripci√≥n)</label>
          <input type="text" id="res-match" placeholder="Boca vs River - Fecha 5">
        </div>
        <div class="fields-grid" style="grid-template-columns:1fr 1fr">
          <div class="form-row"><label>Goles Boca</label><input type="number" id="res-boca" min="0" value="0"></div>
          <div class="form-row"><label>Goles rival</label><input type="number" id="res-rival" min="0" value="0"></div>
        </div>
        <button class="btn orange" data-action="adminProcessResult">‚ö° Procesar y sumar puntos</button>
      </div>

    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     üî• FIREBASE + L√ìGICA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp }                                   from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// ‚ïê‚ïê CONFIG FIREBASE ‚ïê‚ïê
const firebaseConfig = {
  apiKey:            "AIzaSyCy5jTY2XWQgPH3b7xea-0kslJ6Yycbugc",
  authDomain:        "apertura-tabla.firebaseapp.com",
  databaseURL:       "https://apertura-tabla-default-rtdb.firebaseio.com",
  projectId:         "apertura-tabla",
  storageBucket:     "apertura-tabla.firebasestorage.app",
  messagingSenderId: "457726806616",
  appId:             "1:457726806616:web:0a6d01b72f5826eb24182d"
};

// ‚ïê‚ïê CONFIG API ‚ïê‚ïê
// TheSportsDB ‚Äî gratuita, sin API key, sin problemas de CORS
const BOCA_ID_SDB = "133714"; // ID de Boca Juniors en TheSportsDB
const SDB_BASE = "https://www.thesportsdb.com/api/v1/json/3";

const app    = initializeApp(firebaseConfig);
const db     = getDatabase(app);
const auth   = getAuth(app);
const provider = new GoogleAuthProvider();

// ‚ïê‚ïê REFS ‚ïê‚ïê
const teamsRef     = ref(db, "apertura/zonaA");
const pronosRef    = ref(db, "pronosticos");
const authUsersRef = ref(db, "autorizados");

// ‚ïê‚ïê ESTADO ‚ïê‚ïê
let teams        = [];
let currentUser  = null;
let isAdmin      = false;
let authUsers    = {};   // { uid: { email, teamName } }
let pronosticos  = {};   // { matchId: { uid: { local, visitante, ts } } }
let bocaFixtures = [];

// ‚ïê‚ïê ESCUDOS ‚ïê‚ïê
const PALETTE = [
  ["#e74c3c","#c0392b"],["#3498db","#2980b9"],["#2ecc71","#27ae60"],
  ["#9b59b6","#8e44ad"],["#e67e22","#d35400"],["#1abc9c","#16a085"],
  ["#f1c40f","#f39c12"],["#e91e63","#c2185b"],["#00bcd4","#0097a7"],
  ["#ff5722","#e64a19"],["#607d8b","#455a64"],["#8bc34a","#689f38"],
];
const shields = {
  Keko:  svg("K","#e74c3c","#c0392b"),
  Lalo:  svg("L","#3498db","#2980b9"),
  Ray:   svg("R","#2ecc71","#27ae60"),
  Manu:  svg("M","#9b59b6","#8e44ad"),
  Juanca:svg("J","#e67e22","#d35400"),
  Brai:  svg("B","#1abc9c","#16a085"),
  Hebe:  svg("H","#e91e63","#c2185b"),
};
function svg(l,f,s){return`<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="${f}" stroke="${s}" stroke-width="1.5"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">${l}</text></svg>`;}
function getShield(name){
  if(!shields[name]){const l=(name||"?")[0].toUpperCase();const idx=Object.keys(shields).length;const [f,s]=PALETTE[idx%PALETTE.length];shields[name]=svg(l,f,s);}
  return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(shields[name])))}`;
}

// ‚ïê‚ïê HELPERS ‚ïê‚ïê
function showToast(msg, color="#2ecc71"){
  const t=document.getElementById("toast");
  t.textContent=msg;t.style.background=color;
  t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2800);
}
function setSyncStatus(s){
  const el=document.getElementById("sync-status");
  if(!el)return;
  const map={syncing:["loading","‚è≥ Guardando..."],synced:["ok","‚úÖ Guardado en Firebase"],error:["err","‚ùå Error de conexi√≥n"]};
  const[cls,txt]=map[s]||["",""];
  el.className="sync-status "+cls;el.textContent=txt;
}
function getDiff(t){return t.gf-t.gc;}
function posClass(i){return i===0?"p1":i<3?"pmid":"plow";}
function rowClass(i){return i===0?"top1":i<3?"octavos":"";}

// ‚ïê‚ïê TABLA ‚ïê‚ïê
const DEFAULT_TEAMS=[
  {name:"Keko",  pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Lalo",  pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Ray",   pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Manu",  pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Juanca",pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Brai",  pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
  {name:"Hebe",  pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]},
];

onValue(teamsRef,(snap)=>{
  const data=snap.val();
  teams=data&&Array.isArray(data)?data:JSON.parse(JSON.stringify(DEFAULT_TEAMS));
  if(!data)set(teamsRef,DEFAULT_TEAMS);
  renderTabla();
  refreshAdminSelect();
  setSyncStatus("synced");
});

function renderTabla(){
  const tbody=document.getElementById("tabla-body");
  tbody.innerHTML="";
  teams.forEach((t,i)=>{
    const diff=getDiff(t);
    const row=document.createElement("tr");
    row.className=rowClass(i);
    row.innerHTML=`
      <td class="pos ${posClass(i)}">${i+1}</td>
      <td class="team-name"><div class="team-cell"><img class="escudo" src="${getShield(t.name)}" alt="${t.name}">${t.name}</div></td>
      <td class="pts">${t.pts}</td><td>${t.j}</td>
      <td>${t.gf}:${t.gc}</td>
      <td>${diff>0?"+"+diff:diff}</td>
      <td>${t.g}</td><td>${t.e}</td><td>${t.p}</td>
      <td><div class="ultimas">${t.ul.map(r=>`<span class="badge ${r}">${r}</span>`).join("")}</div></td>`;
    tbody.appendChild(row);
  });
}

// ‚ïê‚ïê AUTH ‚ïê‚ïê
onAuthStateChanged(auth,async(user)=>{
  currentUser=user;
  const snap=await get(authUsersRef);
  authUsers=snap.val()||{};

  if(user){
    const authorized=Object.values(authUsers).find(u=>u.email===user.email);
    isAdmin=authorized?.role==="admin";

    document.getElementById("login-overlay").classList.remove("active");

    if(!authorized){
      // Primera vez: mostrar selector de equipo
      showTeamSelector(user);
      return;
    }

    setLoggedInUI(user, authorized.teamName);
    renderPronosticos();
    if(isAdmin) renderAuthUsers();
  } else {
    document.getElementById("user-pill").style.display="none";
    document.getElementById("btn-logout-nav").style.display="none";
    document.getElementById("btn-login-nav").style.display="block";
    document.getElementById("admin-wrapper").style.display="none";
    document.getElementById("team-select-overlay").classList.remove("active");
    renderPronosticosLoggedOut();
  }
});

function setLoggedInUI(user, teamName){
  document.getElementById("user-pill").style.display="flex";
  document.getElementById("user-avatar").src=user.photoURL||"";
  document.getElementById("user-name-nav").textContent=teamName||user.displayName||user.email;
  document.getElementById("btn-logout-nav").style.display="block";
  document.getElementById("btn-login-nav").style.display="none";
  document.getElementById("team-select-overlay").classList.remove("active");
}

// ‚îÄ‚îÄ Selector de equipo (primera vez) ‚îÄ‚îÄ
function showTeamSelector(user){
  document.getElementById("team-select-overlay").classList.add("active");
  document.getElementById("team-select-sub").textContent=
    `¬°Hola! Iniciaste sesi√≥n con ${user.email}. ¬øCu√°l es tu nombre en el torneo?`;
  document.getElementById("team-select-error").textContent="";
  renderTeamGrid();
}

function renderTeamGrid(){
  const takenNames=Object.values(authUsers).map(u=>u.teamName);
  const grid=document.getElementById("team-grid");
  grid.innerHTML=teams.map(t=>{
    const taken=takenNames.includes(t.name);
    return`<button class="team-btn${taken?" taken":""}"
      data-team="${t.name}"
      ${taken?"disabled":""}
      style="${taken?"cursor:not-allowed":"cursor:pointer"}">
      <img src="${getShield(t.name)}" alt="${t.name}">
      <div class="team-btn-info">
        <span class="team-btn-name">${t.name}</span>
        <span class="${taken?"team-btn-taken":"team-btn-free"}">${taken?"Ocupado":"Disponible"}</span>
      </div>
    </button>`;
  }).join("");
  // Usar event delegation en vez de onclick inline
  grid.querySelectorAll(".team-btn:not([disabled])").forEach(btn=>{
    btn.addEventListener("click",()=>selectTeam(btn.dataset.team));
  });
}

window.selectTeam=async(teamName)=>{
  if(!currentUser)return;
  // Verificar que nadie tom√≥ el nombre mientras tanto
  const snap=await get(authUsersRef);
  const fresh=snap.val()||{};
  const alreadyTaken=Object.values(fresh).find(u=>u.teamName===teamName);
  if(alreadyTaken){
    document.getElementById("team-select-error").textContent="‚ö†Ô∏è Ese nombre ya fue tomado. Eleg√≠ otro.";
    authUsers=fresh;
    renderTeamGrid();
    return;
  }
  // Guardar en Firebase
  const newRef=push(authUsersRef);
  await set(newRef,{
    email: currentUser.email,
    teamName,
    role: "player",
    uid: currentUser.uid,
    registeredAt: Date.now(),
  });
  authUsers=fresh;
  authUsers[newRef.key]={email:currentUser.email,teamName,role:"player",uid:currentUser.uid};
  setLoggedInUI(currentUser, teamName);
  showToast(`üéâ ¬°Bienvenido al torneo, ${teamName}!`);
  renderPronosticos();
};

window.showLogin=()=>{
  document.getElementById("login-overlay").classList.add("active");
  document.getElementById("login-error").textContent="";
};
document.getElementById("btn-google-login").onclick=async()=>{
  try{
    await signInWithPopup(auth,provider);
  }catch(e){
    document.getElementById("login-error").textContent="‚ùå Error al iniciar sesi√≥n. Intent√° de nuevo.";
  }
};
window.doLogout=async()=>{
  await signOut(auth);
  showToast("üîí Sesi√≥n cerrada","#e74c3c");
};

// ‚ïê‚ïê TABS ‚ïê‚ïê
window.showTab=(tab)=>{
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.querySelector(`.tab[data-tab="${tab}"]`).classList.add("active");
  document.getElementById("page-"+tab).classList.add("active");
  if(tab==="boca") loadBocaFixtures();
  if(tab==="pronosticos"&&currentUser&&!apiMatches.length) loadApiMatches();
};

// Event delegation para tabs
document.querySelectorAll(".tab[data-tab]").forEach(tab=>{
  tab.addEventListener("click",()=>showTab(tab.dataset.tab));
});

// ‚ïê‚ïê ADMIN PANEL ‚Äî toggle con Ctrl+Shift+A ‚ïê‚ïê
document.addEventListener("keydown",e=>{
  if(e.ctrlKey&&e.shiftKey&&e.key==="A"&&isAdmin){
    const w=document.getElementById("admin-wrapper");
    w.style.display=w.style.display==="none"?"block":"none";
  }
});

// ‚ïê‚ïê ADMIN: Tabla ‚ïê‚ïê
function refreshAdminSelect(){
  const sel=document.getElementById("sel-team");
  if(!sel)return;
  const cur=sel.value;
  sel.innerHTML=teams.map((t,i)=>`<option value="${i}">${i+1}. ${t.name}</option>`).join("");
  if(cur&&parseInt(cur)<teams.length)sel.value=cur;
  // Tambi√©n llenar el select de equipo para autorizar usuarios
  const selUT=document.getElementById("new-user-team");
  if(selUT) selUT.innerHTML=teams.map(t=>`<option value="${t.name}">${t.name}</option>`).join("");
}
window.adminLoadTeam=()=>{
  const i=parseInt(document.getElementById("sel-team").value);
  if(isNaN(i))return;
  const t=teams[i];
  document.getElementById("ed-name").value=t.name;
  document.getElementById("ed-pts").value=t.pts;
  document.getElementById("ed-j").value=t.j;
  document.getElementById("ed-g").value=t.g;
  document.getElementById("ed-e").value=t.e;
  document.getElementById("ed-p").value=t.p;
  document.getElementById("ed-gf").value=t.gf;
  document.getElementById("ed-gc").value=t.gc;
  ["ul-1","ul-2","ul-3","ul-4","ul-5"].forEach((id,idx)=>{
    document.getElementById(id).value=t.ul[idx]||"E";
  });
};
window.adminSaveTeam=async()=>{
  const i=parseInt(document.getElementById("sel-team").value);
  if(isNaN(i))return;
  const newName=document.getElementById("ed-name").value.trim()||teams[i].name;
  teams[i]={
    name:newName,
    pts:parseInt(document.getElementById("ed-pts").value)||0,
    j:parseInt(document.getElementById("ed-j").value)||0,
    g:parseInt(document.getElementById("ed-g").value)||0,
    e:parseInt(document.getElementById("ed-e").value)||0,
    p:parseInt(document.getElementById("ed-p").value)||0,
    gf:parseInt(document.getElementById("ed-gf").value)||0,
    gc:parseInt(document.getElementById("ed-gc").value)||0,
    ul:["ul-1","ul-2","ul-3","ul-4","ul-5"].map(id=>document.getElementById(id).value),
  };
  setSyncStatus("syncing");
  await set(teamsRef,teams);
  showToast("‚úÖ ¬°Guardado!");
};
window.adminDeleteTeam=async()=>{
  const i=parseInt(document.getElementById("sel-team").value);
  if(isNaN(i))return;
  if(!confirm(`¬øEliminar a "${teams[i].name}"?`))return;
  teams.splice(i,1);
  await set(teamsRef,teams);
  showToast("üóëÔ∏è Equipo eliminado","#e74c3c");
};
window.adminAddTeam=async()=>{
  const name=document.getElementById("new-team-name").value.trim();
  if(!name){showToast("‚ö†Ô∏è Escrib√≠ un nombre","#e67e22");return;}
  teams.push({name,pts:0,j:0,g:0,e:0,p:0,gf:0,gc:0,ul:["E","E","E","E","E"]});
  await set(teamsRef,teams);
  document.getElementById("new-team-name").value="";
  showToast(`‚úÖ "${name}" agregado`);
};
window.adminSortTeams=async()=>{
  teams.sort((a,b)=>b.pts!==a.pts?b.pts-a.pts:getDiff(b)-getDiff(a));
  await set(teamsRef,teams);
  showToast("üîÉ Reordenado y guardado");
};

// ‚ïê‚ïê ADMIN: Usuarios autorizados ‚ïê‚ïê
function renderAuthUsers(){
  const el=document.getElementById("auth-users-list");
  if(!el)return;
  const entries=Object.entries(authUsers);
  if(!entries.length){el.innerHTML='<p style="font-size:12px;color:#4a6a84">Sin jugadores a√∫n</p>';return;}
  el.innerHTML=entries.map(([uid,u])=>`
    <div class="user-row">
      <div>
        <div style="font-weight:600;color:#ddeeff">${u.teamName} ${u.role==="admin"?"üëë":""}</div>
        <div class="uid">${u.email}</div>
      </div>
      <button class="btn-small red" data-remove-uid="${uid}">‚úï</button>
    </div>`).join("");
}
window.adminAddUser=async()=>{
  const email=document.getElementById("new-user-email").value.trim();
  const teamName=document.getElementById("new-user-team").value;
  if(!email){showToast("‚ö†Ô∏è Ingres√° un email","#e67e22");return;}
  // Buscar si ya existe
  const exists=Object.values(authUsers).find(u=>u.email===email);
  if(exists){showToast("‚ö†Ô∏è Ese email ya est√° autorizado","#e67e22");return;}
  const newRef=push(authUsersRef);
  await set(newRef,{email,teamName,role:"player"});
  document.getElementById("new-user-email").value="";
  showToast(`‚úÖ ${teamName} autorizado`);
};
window.adminRemoveUser=async(uid)=>{
  if(!confirm("¬øQuitar este jugador?"))return;
  await remove(ref(db,`autorizados/${uid}`));
  showToast("üóëÔ∏è Jugador removido","#e74c3c");
};
onValue(authUsersRef,(snap)=>{
  authUsers=snap.val()||{};
  if(isAdmin)renderAuthUsers();
  // Actualizar grid si el selector est√° abierto (alguien m√°s puede estar eligiendo)
  const overlay=document.getElementById("team-select-overlay");
  if(overlay.classList.contains("active"))renderTeamGrid();
});

// ‚ïê‚ïê PRON√ìSTICOS ‚ïê‚ïê
let apiMatches = []; // partidos reales tra√≠dos de la API

// Cargar partidos desde TheSportsDB (gratuita, sin CORS)
async function loadApiMatches(){
  try{
    const now = new Date();
    const season = now.getFullYear();

    // Traer los √∫ltimos 15 partidos y los pr√≥ximos 15
    const [nextRes, lastRes] = await Promise.all([
      fetch(`${SDB_BASE}/eventsnext.php?id=${BOCA_ID_SDB}`),
      fetch(`${SDB_BASE}/eventslast.php?id=${BOCA_ID_SDB}`),
    ]);
    const nextData = await nextRes.json();
    const lastData = await lastRes.json();

    const nextEvents = nextData.events || [];
    const lastEvents = lastData.results || [];

    const mapEvent = (e, finished) => ({
      id: "boca_"+e.idEvent,
      fixtureId: e.idEvent,
      label: `${e.strHomeTeam} vs. ${e.strAwayTeam}`,
      date: e.dateEvent+"T"+(e.strTime||"00:00:00"),
      competicion: e.strLeague||"",
      estadio: e.strVenue||"",
      started: finished,
      finished: finished,
      goalsHome: finished ? parseInt(e.intHomeScore)||0 : null,
      goalsAway: finished ? parseInt(e.intAwayScore)||0 : null,
      homeName: e.strHomeTeam,
      awayName: e.strAwayTeam,
      thumbUrl: e.strThumb||"",
    });

    const seen = new Set();
    const all = [
      ...lastEvents.map(e=>mapEvent(e,true)),
      ...nextEvents.map(e=>mapEvent(e,false)),
    ].filter(e=>{
      if(seen.has(e.id)) return false;
      seen.add(e.id); return true;
    });

    apiMatches = all;
    if(currentUser) renderPronosticos();
  }catch(e){
    console.error("Error cargando partidos:",e);
    document.getElementById("pronosticos-content").innerHTML=`
      <div class="no-match">
        <div class="icon">‚ö†Ô∏è</div>
        <p>No se pudieron cargar los partidos. Verific√° tu conexi√≥n.</p>
        <button class="btn blue" style="max-width:160px;margin:16px auto 0" data-action="refreshPronosticos">üîÑ Reintentar</button>
      </div>`;
  }
}

function renderPronosticosLoggedOut(){
  document.getElementById("pronosticos-content").innerHTML=`
    <div class="no-match">
      <div class="icon">üîí</div>
      <p>Inici√° sesi√≥n para ver y cargar tus pron√≥sticos</p>
      <button class="btn blue" style="max-width:200px;margin:16px auto 0" data-action="showLogin">üîë Entrar</button>
    </div>`;
}

function renderPronosticos(){
  if(!currentUser)return renderPronosticosLoggedOut();
  const uid=currentUser.uid;
  const userData=Object.values(authUsers).find(u=>u.email===currentUser.email);
  const teamName=userData?.teamName||currentUser.displayName;

  if(!apiMatches.length){
    document.getElementById("pronosticos-content").innerHTML=`
      <div class="no-match">
        <div class="spinner" style="width:32px;height:32px;border:3px solid #2a3d54;border-top-color:#3498db;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px"></div>
        <p>Cargando partidos de Boca...</p>
      </div>`;
    loadApiMatches();
    return;
  }

  let html=`<p style="font-size:13px;color:#7fa8c8;margin-bottom:16px">
    Tus pron√≥sticos, <strong style="color:#fff">${teamName}</strong>. 
    Solo pod√©s modificarlos hasta que empiece el partido.
  </p>`;

  // Separar en secciones
  const live=apiMatches.filter(m=>m.started&&!m.finished);
  const upcoming=apiMatches.filter(m=>!m.started&&!m.finished);
  const finished=apiMatches.filter(m=>m.finished);

  if(live.length){
    html+=`<div class="section-title" style="margin-bottom:12px;font-size:14px">üî¥ En vivo</div>`;
    live.forEach(match=>{ html+=buildPronoCard(match,uid); });
  }
  if(upcoming.length){
    html+=`<div class="section-title" style="margin-bottom:12px;font-size:14px;margin-top:${live.length?"20px":"0"}">üìÖ Pr√≥ximos partidos</div>`;
    upcoming.forEach(match=>{ html+=buildPronoCard(match,uid); });
  }
  if(finished.length){
    html+=`<div class="section-title" style="margin-bottom:12px;font-size:14px;margin-top:20px">üìã Partidos terminados</div>`;
    finished.forEach(match=>{ html+=buildPronoCard(match,uid); });
  }

  html+=`<div style="text-align:center;margin-top:20px">
    <button class="btn blue" style="max-width:180px;margin:0 auto" data-action="refreshPronosticos">üîÑ Actualizar partidos</button>
  </div>`;

  document.getElementById("pronosticos-content").innerHTML=html;
}

function buildPronoCard(match, uid){
  const now=new Date();
  const matchDate=new Date(match.date);
  const locked=match.started||match.finished||now>=matchDate;
  const myProno=pronosticos[match.id]?.[uid];

  // Determinar nombre local/visitante con Boca resaltado
  const isBocaHome=match.homeName.toLowerCase().includes("boca");
  const bocaLabel=isBocaHome?match.homeName:match.awayName;
  const rivalLabel=isBocaHome?match.awayName:match.homeName;

  let card=`<div class="pronostico-card">
    <h3>${match.label}</h3>
    <div class="match-info">
      üìÖ ${matchDate.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})} ¬∑ ${matchDate.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})} hs
      ${match.competicion?` &nbsp;¬∑&nbsp; üèÜ ${match.competicion}`:""}
      ${match.estadio?` &nbsp;¬∑&nbsp; üèüÔ∏è ${match.estadio}`:""}
    </div>`;

  if(match.finished){
    // Mostrar resultado real
    card+=`<div class="pronostico-locked" style="background:#1e3a2a;border:1px solid #2ecc71">
      ‚úÖ Resultado final: <strong style="margin-left:6px;font-size:16px;font-family:'Barlow Condensed',sans-serif;color:#2ecc71">
        ${match.goalsHome} - ${match.goalsAway}
      </strong>
      ${myProno?` &nbsp;¬∑&nbsp; Tu pron√≥stico: <strong style="font-size:15px;font-family:'Barlow Condensed',sans-serif">${myProno.local} - ${myProno.visitante}</strong>`:""}
    </div>`;
  } else if(locked){
    card+=`<div class="pronostico-locked">üîí Pron√≥stico cerrado ‚Äî partido en curso
      ${myProno?` &nbsp;¬∑&nbsp; Tu pron√≥stico: <strong style="margin-left:6px;font-size:16px;font-family:'Barlow Condensed',sans-serif">${myProno.local} - ${myProno.visitante}</strong>`:""}
    </div>`;
  } else {
    card+=`<div class="pronostico-form">
      <div class="score-input-group">
        <label>${bocaLabel}</label>
        <input class="score-input" type="number" id="prono-local-${match.id}" min="0" max="20" value="${myProno?.local??0}">
      </div>
      <span class="score-sep">-</span>
      <div class="score-input-group">
        <input class="score-input" type="number" id="prono-visit-${match.id}" min="0" max="20" value="${myProno?.visitante??0}">
        <label>${rivalLabel}</label>
      </div>
      <button class="btn-pronostico" data-match="${match.id}" data-uid="${uid}" id="btn-save-${match.id}">
        ${myProno?"‚úèÔ∏è Actualizar":"üíæ Guardar"} pron√≥stico
      </button>
    </div>`;
  }

  // Mostrar pron√≥sticos de todos cuando el partido empez√≥ o termin√≥
  if(locked&&pronosticos[match.id]){
    card+=`<div class="pronos-list">`;
    Object.entries(pronosticos[match.id]).forEach(([pUid,prono])=>{
      const pUser=Object.values(authUsers).find(u=>u.uid===pUid)||{teamName:"?"};
      const pts=prono.pts;
      card+=`<div class="prono-row">
        <span class="name">${pUser.teamName}</span>
        <span class="score">${prono.local} - ${prono.visitante}</span>
        <span class="pts-earned ${pts>0?"win":pts===0&&pts!==undefined?"lose":"pending"}">
          ${pts!==undefined?(pts>0?"+"+pts+" pts ‚úÖ":"Sin pts ‚ùå"):"‚è≥ Pendiente"}
        </span>
      </div>`;
    });
    card+=`</div>`;
  }

  card+=`</div>`;
  return card;
}

window.saveProno=async(matchId,uid)=>{
  const local=parseInt(document.getElementById(`prono-local-${matchId}`).value)||0;
  const visitante=parseInt(document.getElementById(`prono-visit-${matchId}`).value)||0;
  const match=apiMatches.find(m=>m.id===matchId);
  if(!match)return;
  if(match.started||new Date()>=new Date(match.date)){
    showToast("‚õî El partido ya empez√≥, no pod√©s cambiar tu pron√≥stico","#e74c3c");return;
  }
  await set(ref(db,`pronosticos/${matchId}/${uid}`),{local,visitante,ts:Date.now()});
  showToast("üíæ Pron√≥stico guardado ‚úÖ");
  renderPronosticos();
};

window.refreshPronosticos=()=>{
  apiMatches=[];
  renderPronosticos();
};

onValue(pronosRef,(snap)=>{
  pronosticos=snap.val()||{};
  if(currentUser)renderPronosticos();
});

// ‚ïê‚ïê ADMIN: Procesar resultado ‚ïê‚ïê
window.adminProcessResult=async()=>{
  const matchDesc=document.getElementById("res-match").value.trim();
  const bocaGoals=parseInt(document.getElementById("res-boca").value)||0;
  const rivalGoals=parseInt(document.getElementById("res-rival").value)||0;
  if(!matchDesc){showToast("‚ö†Ô∏è Ingres√° el partido","#e67e22");return;}

  // Buscar el matchId en los partidos cargados de la API
  const matchOptions=apiMatches.map((m,i)=>`${i+1}. ${m.label} (${new Date(m.date).toLocaleDateString("es-AR")})`).join("\n");
  const idx=prompt(`Seleccion√° el n√∫mero del partido:\n${matchOptions}`);
  if(!idx)return;
  const matchId=apiMatches[parseInt(idx)-1]?.id;
  if(!matchId){showToast("‚ö†Ô∏è N√∫mero inv√°lido","#e67e22");return;}

  const matchPronos=pronosticos[matchId];
  if(!matchPronos){showToast("‚ö†Ô∏è No hay pron√≥sticos para ese partido","#e67e22");return;}

  let updates={};
  let summary=[];

  for(const [uid,prono] of Object.entries(matchPronos)){
    const acertoBoca=prono.local===bocaGoals;
    const acertoRival=prono.visitante===rivalGoals;
    const pts=(acertoBoca&&acertoRival)?3:0;
    updates[`pronosticos/${matchId}/${uid}/pts`]=pts;

    // Sumar a la tabla si acert√≥
    if(pts>0){
      const userData=Object.values(authUsers).find(u=>u.uid===uid);
      const teamIdx=teams.findIndex(t=>t.name===userData?.teamName);
      if(teamIdx>=0){
        teams[teamIdx].pts+=pts;
        const ul=teams[teamIdx].ul;ul.pop();ul.unshift("V");
      }
      summary.push(`‚úÖ ${userData?.teamName||uid}: +3 pts`);
    } else {
      const userData=Object.values(authUsers).find(u=>u.uid===uid);
      summary.push(`‚ùå ${userData?.teamName||uid}: sin puntos`);
    }
  }

  await update(ref(db),updates);
  await set(teamsRef,teams);
  showToast("‚ö° Puntos procesados y actualizados");
  alert("Resultado procesado:\n\n"+summary.join("\n"));
};

// ‚ïê‚ïê BOCA FIXTURES ‚ïê‚ïê
async function loadBocaFixtures(){
  const el=document.getElementById("boca-content");
  el.innerHTML=`<div class="loading-fixtures"><div class="spinner"></div><p>Cargando partidos de Boca...</p></div>`;

  try{
    const res=await fetch(PROXY_URL);
    if(!res.ok) throw new Error("Error "+res.status);
    const data=await res.json();
    renderBocaFixtures(el, data);
  }catch(e){
    console.error(e);
    el.innerHTML=`<div class="no-match"><div class="icon">‚ö†Ô∏è</div><p>No se pudieron cargar los partidos. Intent√° de nuevo en unos segundos.</p><button class="btn blue" style="max-width:160px;margin:16px auto 0" data-action="loadBocaFixtures">üîÑ Reintentar</button></div>`;
  }
}

function fixtureCardHTML(f){
  const date=new Date(f.date);
  const localTeam=f.local?"Boca Juniors":f.rival;
  const visitTeam=f.local?f.rival:"Boca Juniors";
  return`<div class="fixture-card">
    <div class="fixture-header">
      <span>${f.competicion}</span>
      <span>üìÖ ${date.toLocaleDateString("es-AR",{day:"numeric",month:"short"})}</span>
    </div>
    <div class="fixture-body">
      <div class="fixture-teams">
        <div class="fixture-team">
          <div style="font-size:32px">${f.local?"üíôüíõ":"üî¥"}</div>
          <div class="fixture-team-name">${localTeam}</div>
        </div>
        <div class="fixture-score-box">
          <div class="fixture-score">vs</div>
          <div class="fixture-time">${date.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})} hs</div>
        </div>
        <div class="fixture-team">
          <div style="font-size:32px">${f.local?f.logo:"üíôüíõ"}</div>
          <div class="fixture-team-name">${visitTeam}</div>
        </div>
      </div>
    </div>
    <div class="fixture-footer">
      <span>üèüÔ∏è ${f.estadio}</span>
    </div>
  </div>`;
}

// ‚ïê‚ïê ADMIN AUTORIZADO POR DEFECTO: vos ‚ïê‚ïê
// Cuando est√©s logueado por primera vez, ejecut√° esto en la consola del navegador:
// set(ref(db,"autorizados/admin"),{email:"TU_EMAIL@gmail.com",teamName:"Admin",role:"admin"})
// ‚ïê‚ïê EVENT DELEGATION GLOBAL ‚ïê‚ïê
document.addEventListener("click", e=>{
  const btn = e.target.closest("[data-action]");
  if(btn){
    const action = btn.dataset.action;
    if(action==="showLogin") showLogin();
    if(action==="adminSaveTeam") adminSaveTeam();
    if(action==="adminDeleteTeam") adminDeleteTeam();
    if(action==="adminAddTeam") adminAddTeam();
    if(action==="adminSortTeams") adminSortTeams();
    if(action==="adminAddUser") adminAddUser();
    if(action==="adminProcessResult") adminProcessResult();
    if(action==="loadBocaFixtures") loadBocaFixtures();
    if(action==="refreshPronosticos") refreshPronosticos();
  }
  // adminRemoveUser buttons
  const removeBtn = e.target.closest("[data-remove-uid]");
  if(removeBtn) adminRemoveUser(removeBtn.dataset.removeUid);
});

// Logout btn
const logoutBtn = document.getElementById("btn-do-logout");
if(logoutBtn) logoutBtn.addEventListener("click", doLogout);

// Sel-team change
document.addEventListener("change", e=>{
  if(e.target.id==="sel-team-input") adminLoadTeam();
});

// Fix sel-team id
const selTeamInput = document.getElementById("sel-team-input");
if(selTeamInput) selTeamInput.id = "sel-team";

console.log("üéÆ Gaymers App cargada. Admin: Ctrl+Shift+A (solo cuando est√©s logueado como admin)");
</script>
</body>
</html>
