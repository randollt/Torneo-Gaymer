<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apertura - Zona A</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Barlow', sans-serif; background: #0f1923; padding: 24px; display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; justify-content: center; min-height: 100vh; }

  /* TOAST */
  #toast {
    position: fixed; bottom: 24px; right: 24px;
    background: #2ecc71; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 700; letter-spacing: 1px;
    padding: 12px 20px; border-radius: 8px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.4);
    opacity: 0; transition: opacity 0.3s;
    pointer-events: none; z-index: 999;
  }
  #toast.show { opacity: 1; }

  /* LOGIN OVERLAY */
  #login-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(10,16,24,0.92);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }
  #login-overlay.active { display: flex; }
  .login-box {
    background: #1a2332; border-radius: 14px;
    padding: 32px 28px; width: 100%; max-width: 340px;
    box-shadow: 0 12px 48px rgba(0,0,0,0.6);
  }
  .login-box h2 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 22px; font-weight: 800; color: #fff;
    letter-spacing: 2px; text-transform: uppercase;
    margin-bottom: 20px; text-align: center;
  }
  .login-box label { font-size: 11px; color: #7fa8c8; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 4px; margin-top: 14px; }
  .login-box input {
    width: 100%; background: #243447; border: 1px solid #2e4060;
    border-radius: 6px; padding: 10px 12px; color: #fff;
    font-family: 'Barlow', sans-serif; font-size: 14px; outline: none;
  }
  .login-box input:focus { border-color: #3498db; }
  .login-error { color: #e74c3c; font-size: 12px; margin-top: 10px; min-height: 18px; text-align: center; }
  .btn-login {
    margin-top: 20px; width: 100%;
    background: #3498db; border: none; border-radius: 8px;
    padding: 12px; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px; font-weight: 800; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s;
  }
  .btn-login:hover { background: #2980b9; }

  /* TABLA */
  .tabla-container {
    max-width: 680px; min-width: 340px;
    background: #1a2332; border-radius: 12px;
    overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .titulo {
    background: #243447; text-align: center; padding: 14px 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 20px; font-weight: 800; color: #fff;
    letter-spacing: 3px; text-transform: uppercase;
    border-bottom: 2px solid #2e4060;
  }
  .zona-header {
    background: #1e2d3d; padding: 8px 16px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px; font-weight: 700; color: #7fa8c8;
    letter-spacing: 2px; text-transform: uppercase;
    border-bottom: 1px solid #2a3d54;
  }
  table { width: 100%; border-collapse: collapse; }
  thead tr { background: #1e2d3d; }
  thead th {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px; font-weight: 700; color: #6a8fad;
    text-transform: uppercase; letter-spacing: 1px;
    padding: 8px 6px; text-align: center;
    border-bottom: 1px solid #2a3d54;
  }
  thead th.team-col { text-align: left; padding-left: 12px; }
  tbody tr { border-bottom: 1px solid #1e2d3d; transition: background 0.15s; }
  tbody tr:hover { background: #223040; }
  tbody tr.top1   { border-left: 3px solid #f1c40f; }
  tbody tr.octavos { border-left: 3px solid #3498db; }
  td { padding: 9px 6px; text-align: center; font-size: 13px; color: #c8dae8; font-weight: 500; }
  td.pos { font-family: 'Barlow Condensed', sans-serif; font-size: 15px; font-weight: 800; width: 28px; }
  td.pos.p1   { color: #f1c40f; }
  td.pos.pmid { color: #3498db; }
  td.pos.plow { color: #8fa8c0; }
  td.team-name { text-align: left; padding-left: 6px; font-size: 13px; font-weight: 600; color: #ddeeff; white-space: nowrap; }
  td.pts { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 800; color: #fff; }
  .team-cell { display: flex; align-items: center; gap: 8px; }
  .escudo { width: 28px; height: 28px; flex-shrink: 0; }
  .badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 22px; height: 22px; border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 12px; font-weight: 800; margin: 0 1px;
  }
  .badge.V { background: #2ecc71; color: #fff; }
  .badge.E { background: #f39c12; color: #fff; }
  .badge.D { background: #e74c3c; color: #fff; }
  .ultimas { display: flex; gap: 3px; justify-content: center; align-items: center; }
  .leyenda {
    background: #1a2332; padding: 10px 16px;
    display: flex; align-items: center; gap: 16px;
    font-size: 11px; color: #6a8fad; border-top: 1px solid #2a3d54;
  }
  .leyenda-item { display: flex; align-items: center; gap: 6px; }
  .dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .dot.gold { background: #f1c40f; }
  .dot.blue { background: #3498db; }

  /* EDITOR */
  .editor {
    background: #1a2332; border-radius: 12px; padding: 20px;
    min-width: 300px; max-width: 360px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5); color: #c8dae8;
  }
  .editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; border-bottom: 1px solid #2a3d54; padding-bottom: 10px; }
  .editor h2 { font-family: 'Barlow Condensed', sans-serif; font-size: 18px; font-weight: 800; color: #fff; letter-spacing: 2px; text-transform: uppercase; }
  .btn-logout { background: transparent; border: 1px solid #e74c3c; border-radius: 6px; padding: 4px 10px; color: #e74c3c; font-family: 'Barlow Condensed', sans-serif; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
  .btn-logout:hover { background: #e74c3c; color: #fff; }
  #auth-status { font-size: 11px; margin-bottom: 14px; padding: 6px 10px; border-radius: 6px; text-align: center; font-weight: 600; }
  #auth-status.logged-in  { background: #1e3a2a; color: #2ecc71; }
  #auth-status.logged-out { background: #2a1e1e; color: #e74c3c; }
  .editor label { font-size: 11px; color: #7fa8c8; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 4px; margin-top: 12px; }
  .editor select, .editor input[type=text], .editor input[type=number] {
    width: 100%; background: #243447; border: 1px solid #2e4060;
    border-radius: 6px; padding: 7px 10px; color: #fff;
    font-family: 'Barlow', sans-serif; font-size: 13px; outline: none;
  }
  .editor select:focus, .editor input:focus { border-color: #3498db; }
  .row-fields { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; margin-top: 8px; }
  .row-fields label { font-size: 10px; color: #7fa8c8; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 3px; margin-top: 0; }
  .ultimas-editor { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
  .ultimas-editor select { flex: 1; min-width: 56px; padding: 6px 4px; text-align: center; }
  .btn-apply {
    margin-top: 16px; width: 100%;
    background: #2ecc71; border: none; border-radius: 8px;
    padding: 10px; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 800; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s;
  }
  .btn-apply:hover { background: #27ae60; }
  .btn-apply:disabled { background: #2a4a3a; color: #5a8a6a; cursor: not-allowed; }
  .btn-sort {
    margin-top: 8px; width: 100%;
    background: #3498db; border: none; border-radius: 8px;
    padding: 10px; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 800; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s;
  }
  .btn-sort:hover { background: #2980b9; }
  .btn-sort:disabled { background: #1e3a54; color: #4a7a9a; cursor: not-allowed; }
  .btn-login-editor {
    margin-top: 8px; width: 100%;
    background: #f39c12; border: none; border-radius: 8px;
    padding: 10px; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 800; letter-spacing: 1px;
    cursor: pointer; transition: background 0.2s;
  }
  .btn-login-editor:hover { background: #e67e22; }
  .sep { border: none; border-top: 1px solid #2a3d54; margin: 16px 0; }
  .sync-indicator { font-size: 10px; color: #7fa8c8; text-align: center; margin-top: 8px; }
  .sync-indicator.syncing { color: #f39c12; }
  .sync-indicator.synced  { color: #2ecc71; }
</style>
</head>
<body>

<div id="toast"></div>

<!-- LOGIN OVERLAY -->
<div id="login-overlay">
  <div class="login-box">
    <h2>ğŸ” Acceso Admin</h2>
    <label>Email</label>
    <input type="email" id="login-email" placeholder="tu@email.com">
    <label>ContraseÃ±a</label>
    <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
    <div class="login-error" id="login-error"></div>
    <button class="btn-login" onclick="doLogin()">Ingresar</button>
  </div>
</div>

<!-- TABLA -->
<div class="tabla-container">
  <div class="titulo">Apertura</div>
  <div class="zona-header">Zona A</div>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th class="team-col">Equipos</th>
        <th>PTS</th>
        <th>J</th>
        <th>Gol</th>
        <th>+/-</th>
        <th>G</th>
        <th>E</th>
        <th>P</th>
        <th>Ãšltimas</th>
      </tr>
    </thead>
    <tbody id="tabla-body"></tbody>
  </table>
  <div class="leyenda">
    <div class="leyenda-item"><div class="dot gold"></div><span>1er puesto</span></div>
    <div class="leyenda-item"><div class="dot blue"></div><span>Octavos de Final</span></div>
  </div>
</div>

<!-- EDITOR -->
<div class="editor">
  <div class="editor-header">
    <h2>âœï¸ Editor</h2>
    <button class="btn-logout" id="btn-logout" onclick="doLogout()" style="display:none">Cerrar sesiÃ³n</button>
  </div>

  <div id="auth-status" class="logged-out">ğŸ”´ No autenticado â€” solo lectura</div>

  <label>Seleccionar equipo</label>
  <select id="sel-team" onchange="loadTeam()"></select>

  <label>Nombre</label>
  <input type="text" id="ed-name" placeholder="Nombre del equipo">

  <div class="row-fields">
    <div><label>PTS</label><input type="number" id="ed-pts" min="0"></div>
    <div><label>J</label><input type="number" id="ed-j" min="0"></div>
    <div><label>G</label><input type="number" id="ed-g" min="0"></div>
    <div><label>E</label><input type="number" id="ed-e" min="0"></div>
  </div>
  <div class="row-fields">
    <div><label>P</label><input type="number" id="ed-p" min="0"></div>
    <div><label>GF</label><input type="number" id="ed-gf" min="0"></div>
    <div><label>GC</label><input type="number" id="ed-gc" min="0"></div>
    <div></div>
  </div>

  <label>Ãšltimas 5 fechas (1 = mÃ¡s reciente)</label>
  <div class="ultimas-editor">
    <select id="ul-1"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
    <select id="ul-2"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
    <select id="ul-3"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
    <select id="ul-4"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
    <select id="ul-5"><option value="V">V</option><option value="E" selected>E</option><option value="D">D</option></select>
  </div>

  <button class="btn-apply" id="btn-apply" onclick="applyChanges()" disabled>âœ… Guardar en Firebase</button>
  <hr class="sep">
  <button class="btn-sort" id="btn-sort" onclick="sortAndSave()" disabled>ğŸ”ƒ Reordenar por puntos</button>
  <button class="btn-login-editor" onclick="showLogin()">ğŸ” Iniciar sesiÃ³n para editar</button>
  <div class="sync-indicator" id="sync-status">â³ Conectando con Firebase...</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”¥ FIREBASE SDK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ REEMPLAZÃ ESTOS VALORES CON LOS TUYOS
// (los encontrÃ¡s en Firebase Console â†’ ConfiguraciÃ³n del proyecto â†’ Tus apps)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey:            "AIzaSyCy5jTY2XWQgPH3b7xea-0kslJ6Yycbugc",
  authDomain:        "apertura-tabla.firebaseapp.com",
  databaseURL:       "https://apertura-tabla-default-rtdb.firebaseio.com",
  projectId:         "apertura-tabla",
  storageBucket:     "apertura-tabla.firebasestorage.app",
  messagingSenderId: "457726806616",
  appId:             "1:457726806616:web:0a6d01b72f5826eb24182d"
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const app  = initializeApp(firebaseConfig);
const db   = getDatabase(app);
const auth = getAuth(app);
const dbRef = ref(db, "apertura/zonaA");

// â”€â”€ Shields SVG â”€â”€
const shields = {
  Keko:  `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#e74c3c" stroke="#c0392b" stroke-width="1.5"/><path d="M4 18 L36 18" stroke="#fff" stroke-width="2.5" opacity="0.3"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">K</text></svg>`,
  Lalo:  `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/><path d="M20 2 L20 40" stroke="#fff" stroke-width="2.5" opacity="0.3"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">L</text></svg>`,
  Ray:   `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#2ecc71" stroke="#27ae60" stroke-width="1.5"/><circle cx="20" cy="20" r="7" fill="none" stroke="#fff" stroke-width="2" opacity="0.4"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">R</text></svg>`,
  Manu:  `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#9b59b6" stroke="#8e44ad" stroke-width="1.5"/><path d="M4 10 L20 22 L36 10" stroke="#fff" stroke-width="2" fill="none" opacity="0.3"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">M</text></svg>`,
  Juanca:`<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#e67e22" stroke="#d35400" stroke-width="1.5"/><path d="M8 8 L32 32 M32 8 L8 32" stroke="#fff" stroke-width="2" opacity="0.2"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">J</text></svg>`,
  Brai:  `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M20 2 L36 10 L36 26 Q36 36 20 40 Q4 36 4 26 L4 10 Z" fill="#1abc9c" stroke="#16a085" stroke-width="1.5"/><polygon points="20,8 24,18 34,18 26,24 29,34 20,28 11,34 14,24 6,18 16,18" fill="#fff" opacity="0.25"/><text x="20" y="28" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff" font-family="sans-serif">B</text></svg>`,
};

const DEFAULT_TEAMS = [
  { name:"Keko",   pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
  { name:"Lalo",   pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
  { name:"Ray",    pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
  { name:"Manu",   pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
  { name:"Juanca", pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
  { name:"Brai",   pts:0, j:0, g:0, e:0, p:0, gf:0, gc:0, ul:["E","E","E","E","E"] },
];

let teams = JSON.parse(JSON.stringify(DEFAULT_TEAMS));
let isAdmin = false;

// â”€â”€ Helpers UI â”€â”€
function getSVG(name) {
  const svg = shields[name] || shields["Keko"];
  return `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svg)))}`;
}
function getDiff(t) { return t.gf - t.gc; }
function posClass(i) { return i===0 ? "p1" : i<3 ? "pmid" : "plow"; }
function rowClass(i) { return i===0 ? "top1" : i<3 ? "octavos" : ""; }

function showToast(msg, color="#2ecc71") {
  const t = document.getElementById("toast");
  t.textContent = msg; t.style.background = color;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2500);
}

function setSyncStatus(state) {
  const el = document.getElementById("sync-status");
  if (state === "syncing") { el.className = "sync-indicator syncing"; el.textContent = "â³ Sincronizando..."; }
  if (state === "synced")  { el.className = "sync-indicator synced";  el.textContent = "âœ… Sincronizado con Firebase"; }
  if (state === "error")   { el.className = "sync-indicator";         el.textContent = "âŒ Error de conexiÃ³n"; }
}

function setAdminUI(logged) {
  isAdmin = logged;
  document.getElementById("btn-apply").disabled = !logged;
  document.getElementById("btn-sort").disabled  = !logged;
  document.getElementById("btn-logout").style.display = logged ? "block" : "none";
  const status = document.getElementById("auth-status");
  if (logged) {
    status.className = "logged-in";
    status.textContent = "ğŸŸ¢ SesiÃ³n activa â€” podÃ©s editar";
  } else {
    status.className = "logged-out";
    status.textContent = "ğŸ”´ No autenticado â€” solo lectura";
  }
}

// â”€â”€ Render â”€â”€
function renderTable() {
  const tbody = document.getElementById("tabla-body");
  tbody.innerHTML = "";
  teams.forEach((t, i) => {
    const diff = getDiff(t);
    const diffStr = diff > 0 ? `+${diff}` : `${diff}`;
    const row = document.createElement("tr");
    row.className = rowClass(i);
    row.innerHTML = `
      <td class="pos ${posClass(i)}">${i+1}</td>
      <td class="team-name">
        <div class="team-cell">
          <img class="escudo" src="${getSVG(t.name)}" alt="${t.name}">
          ${t.name}
        </div>
      </td>
      <td class="pts">${t.pts}</td>
      <td>${t.j}</td>
      <td>${t.gf}:${t.gc}</td>
      <td>${diffStr}</td>
      <td>${t.g}</td>
      <td>${t.e}</td>
      <td>${t.p}</td>
      <td><div class="ultimas">${t.ul.map(r=>`<span class="badge ${r}">${r}</span>`).join("")}</div></td>
    `;
    tbody.appendChild(row);
  });
  refreshSelect();
}

function refreshSelect() {
  const sel = document.getElementById("sel-team");
  const cur = sel.value;
  sel.innerHTML = teams.map((t,i) => `<option value="${i}">${i+1}. ${t.name}</option>`).join("");
  if (cur !== "" && parseInt(cur) < teams.length) sel.value = cur;
}

window.loadTeam = function() {
  const i = parseInt(document.getElementById("sel-team").value);
  if (isNaN(i)) return;
  const t = teams[i];
  document.getElementById("ed-name").value = t.name;
  document.getElementById("ed-pts").value  = t.pts;
  document.getElementById("ed-j").value    = t.j;
  document.getElementById("ed-g").value    = t.g;
  document.getElementById("ed-e").value    = t.e;
  document.getElementById("ed-p").value    = t.p;
  document.getElementById("ed-gf").value   = t.gf;
  document.getElementById("ed-gc").value   = t.gc;
  ["ul-1","ul-2","ul-3","ul-4","ul-5"].forEach((id, idx) => {
    document.getElementById(id).value = t.ul[idx] || "E";
  });
};

// â”€â”€ Firebase: escuchar cambios en tiempo real â”€â”€
onValue(dbRef, (snapshot) => {
  const data = snapshot.val();
  if (data && Array.isArray(data)) {
    teams = data;
    renderTable();
    setSyncStatus("synced");
  } else {
    // Primera vez: subir datos por defecto
    set(dbRef, DEFAULT_TEAMS);
  }
}, (error) => {
  setSyncStatus("error");
  console.error(error);
});

// â”€â”€ Firebase: guardar â”€â”€
async function saveToFirebase() {
  setSyncStatus("syncing");
  await set(dbRef, teams);
  setSyncStatus("synced");
}

// â”€â”€ Auth â”€â”€
onAuthStateChanged(auth, (user) => { setAdminUI(!!user); });

window.showLogin = function() {
  document.getElementById("login-overlay").classList.add("active");
  document.getElementById("login-error").textContent = "";
};

window.doLogin = async function() {
  const email = document.getElementById("login-email").value.trim();
  const pass  = document.getElementById("login-pass").value;
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    document.getElementById("login-overlay").classList.remove("active");
    showToast("ğŸ”“ SesiÃ³n iniciada");
  } catch(e) {
    document.getElementById("login-error").textContent = "âŒ Email o contraseÃ±a incorrectos";
  }
};

window.doLogout = async function() {
  await signOut(auth);
  showToast("ğŸ”’ SesiÃ³n cerrada", "#e74c3c");
};

// â”€â”€ Acciones del editor â”€â”€
window.applyChanges = async function() {
  if (!isAdmin) return;
  const i = parseInt(document.getElementById("sel-team").value);
  if (isNaN(i)) return;
  const newName = document.getElementById("ed-name").value.trim() || teams[i].name;
  if (newName !== teams[i].name) shields[newName] = shields[teams[i].name] || shields["Keko"];
  teams[i] = {
    name: newName,
    pts:  parseInt(document.getElementById("ed-pts").value) || 0,
    j:    parseInt(document.getElementById("ed-j").value)   || 0,
    g:    parseInt(document.getElementById("ed-g").value)   || 0,
    e:    parseInt(document.getElementById("ed-e").value)   || 0,
    p:    parseInt(document.getElementById("ed-p").value)   || 0,
    gf:   parseInt(document.getElementById("ed-gf").value)  || 0,
    gc:   parseInt(document.getElementById("ed-gc").value)  || 0,
    ul:   ["ul-1","ul-2","ul-3","ul-4","ul-5"].map(id => document.getElementById(id).value),
  };
  await saveToFirebase();
  renderTable();
  document.getElementById("sel-team").value = i;
  showToast("âœ… Â¡Guardado en Firebase!");
};

window.sortAndSave = async function() {
  if (!isAdmin) return;
  teams.sort((a,b) => b.pts !== a.pts ? b.pts - a.pts : getDiff(b) - getDiff(a));
  await saveToFirebase();
  renderTable();
  showToast("ğŸ”ƒ Reordenado y guardado");
};

// Cerrar login con Escape
document.addEventListener("keydown", e => {
  if (e.key === "Escape") document.getElementById("login-overlay").classList.remove("active");
  if (e.key === "Enter" && document.getElementById("login-overlay").classList.contains("active")) window.doLogin();
});
</script>
</body>
</html>
